<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="This is a quick post about PCIe scrambler as part of the physical layer. The polynomial is
 X^16 &#43; X^5 &#43; X^4 &#43; X^3 &#43; 1.
 From Wiki, This type of LSFR is called Galois LSFR where bits at taps(xor) is inverted when bit is 1.
 Named after the French mathematician Évariste Galois, an LFSR in Galois configuration, which is also known as modular, internal XORs, or one-to-many LFSR, is an alternate structure that can generate the same output stream as a conventional LFSR (but offset in time)." />
<meta name="keywords" content=", pci" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/2023/02/pcie-galois-lsfr-scrambler-one-way-to-do-it/" />


    <title>
        
            PCIe Galois LSFR scrambler - one way to do it! :: Techiedeepdive 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css">






<meta itemprop="name" content="PCIe Galois LSFR scrambler - one way to do it!">
<meta itemprop="description" content="This is a quick post about PCIe scrambler as part of the physical layer. The polynomial is
 X^16 &#43; X^5 &#43; X^4 &#43; X^3 &#43; 1.
 From Wiki, This type of LSFR is called Galois LSFR where bits at taps(xor) is inverted when bit is 1.
 Named after the French mathematician Évariste Galois, an LFSR in Galois configuration, which is also known as modular, internal XORs, or one-to-many LFSR, is an alternate structure that can generate the same output stream as a conventional LFSR (but offset in time)."><meta itemprop="datePublished" content="2023-02-15T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-02-15T00:00:00+00:00" />
<meta itemprop="wordCount" content="374"><meta itemprop="image" content=""/>
<meta itemprop="keywords" content="pci," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>

<meta name="twitter:title" content="PCIe Galois LSFR scrambler - one way to do it!"/>
<meta name="twitter:description" content="This is a quick post about PCIe scrambler as part of the physical layer. The polynomial is
 X^16 &#43; X^5 &#43; X^4 &#43; X^3 &#43; 1.
 From Wiki, This type of LSFR is called Galois LSFR where bits at taps(xor) is inverted when bit is 1.
 Named after the French mathematician Évariste Galois, an LFSR in Galois configuration, which is also known as modular, internal XORs, or one-to-many LFSR, is an alternate structure that can generate the same output stream as a conventional LFSR (but offset in time)."/>




    <meta property="og:title" content="PCIe Galois LSFR scrambler - one way to do it!" />
<meta property="og:description" content="This is a quick post about PCIe scrambler as part of the physical layer. The polynomial is
 X^16 &#43; X^5 &#43; X^4 &#43; X^3 &#43; 1.
 From Wiki, This type of LSFR is called Galois LSFR where bits at taps(xor) is inverted when bit is 1.
 Named after the French mathematician Évariste Galois, an LFSR in Galois configuration, which is also known as modular, internal XORs, or one-to-many LFSR, is an alternate structure that can generate the same output stream as a conventional LFSR (but offset in time)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2023/02/pcie-galois-lsfr-scrambler-one-way-to-do-it/" /><meta property="og:image" content=""/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-02-15T00:00:00+00:00" /><meta property="og:site_name" content="Techiedeepdive" />







    <meta property="article:published_time" content="2023-02-15 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts">Blog</a></li><li><a href="/reading-list/">Reading list</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        2 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="/posts/2023/02/pcie-galois-lsfr-scrambler-one-way-to-do-it/">PCIe Galois LSFR scrambler - one way to do it!</a>
      </h1>

      

      

      <div class="post-content">
        <p>This is a quick post about PCIe scrambler as part of the physical layer. The polynomial is</p>
<blockquote>
<p>X^16 + X^5 + X^4 + X^3 + 1.</p>
</blockquote>
<p><img src="/pcie_scrambler.png" alt="Example image"></p>
<p>From <a href="https://en.wikipedia.org/wiki/Linear-feedback_shift_register">Wiki</a>, This type of LSFR is called <code>Galois LSFR</code> where bits at taps(xor) is inverted when bit is 1.</p>
<blockquote>
<p>Named after the French mathematician Évariste Galois, an LFSR in Galois configuration, which is also known as modular, internal XORs, or one-to-many LFSR, is an alternate structure that can generate the same output stream as a conventional LFSR (but offset in time).[5] In the Galois configuration, when the system is clocked, bits that are not taps are shifted one position to the right unchanged. The taps, on the other hand, are XORed with the output bit before they are stored in the next position. The new output bit is the next input bit. The effect of this is that when the output bit is zero, all the bits in the register shift to the right unchanged, and the input bit becomes zero. When the output bit is one, the bits in the tap positions all flip (if they are 0, they become 1, and if they are 1, they become 0), and then the entire register is shifted to the right and the input bit becomes 1.</p>
</blockquote>
<p>This is quick-and-dirty way to do LSFR. It can be done with clever xor but who got time to be clever.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">int2binstr</span>(value):
    b <span style="color:#f92672">=</span> (bin(value)[<span style="color:#ae81ff">2</span>:])<span style="color:#f92672">.</span>zfill(<span style="color:#ae81ff">16</span>)
    <span style="color:#66d9ef">return</span> b

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">lsfr</span>(state):
    xor <span style="color:#f92672">=</span> [<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>]

    next_state <span style="color:#f92672">=</span> [int(x) <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> list(int2binstr(state))]

    tmp <span style="color:#f92672">=</span> list(next_state)

    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">16</span>):
        <span style="color:#66d9ef">if</span> i <span style="color:#f92672">in</span> xor:
            next_state[i] <span style="color:#f92672">=</span> tmp[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>] <span style="color:#f92672">^</span> tmp[<span style="color:#ae81ff">15</span>]
        <span style="color:#66d9ef">else</span>:
            next_state[i] <span style="color:#f92672">=</span> tmp[i<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]

    next_state <span style="color:#f92672">=</span> int(<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">.</span>join([bin(x)[<span style="color:#ae81ff">2</span>:] <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> next_state]),<span style="color:#ae81ff">2</span>)

    <span style="color:#66d9ef">return</span> next_state
    
state <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x0001</span>

s <span style="color:#f92672">=</span> state
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">18</span>):
    o, s <span style="color:#f92672">=</span> (s, lsfr(s))
    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;old=</span><span style="color:#e6db74">{</span>int2binstr(o)<span style="color:#e6db74">}</span><span style="color:#e6db74"> new=</span><span style="color:#e6db74">{</span>int2binstr(s)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</code></pre></div><p>And the output patterns as follows (it&rsquo;s not fully tested. So, hopefully, it&rsquo;s right!)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">old<span style="color:#f92672">=</span><span style="color:#ae81ff">0000000000000001</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">1001110000000000</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">1001110000000000</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0100111000000000</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0100111000000000</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0010011100000000</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0010011100000000</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0001001110000000</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0001001110000000</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0000100111000000</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0000100111000000</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0000010011100000</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0000010011100000</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0000001001110000</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0000001001110000</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0000000100111000</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0000000100111000</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0000000010011100</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0000000010011100</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0000000001001110</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0000000001001110</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0000000000100111</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0000000000100111</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">1001110000010011</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">1001110000010011</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">1101001000001001</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">1101001000001001</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">1111010100000100</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">1111010100000100</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0111101010000010</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0111101010000010</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0011110101000001</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">0011110101000001</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">1000001010100000</span>
old<span style="color:#f92672">=</span><span style="color:#ae81ff">1000001010100000</span> new<span style="color:#f92672">=</span><span style="color:#ae81ff">0100000101010000</span>
</code></pre></div><p>Full disclosure, This is the just first half of the scrambler. The second half is the slower register driven by clocked by Byte clock (bit rate/8).</p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="tags/pci/">pci</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        374 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2023-02-15 00:00 &#43;0000
        

         
          
        
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2023/02/new-computer-who-dis/">
                <span class="button__icon">←</span>
                <span class="button__text">New computer! Who dis?</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="/posts/2023/02/aes-rijndael-s-box-explained/">
                <span class="button__text">AES Rijndael S-box explained</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span><span><a href="posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2ce64ea6ea44a72b13dd812fc2eb5cca3efe878cce258a47c137c17edf46e0602a05e422b618a5b80b5939c731b7a293351c2f2222a21f6ee27e54a8448dd20e.js" integrity="sha512-LOZOpupEpysT3YEvwutcyj7&#43;h4zOJYpHwTfBft9G4GAqBeQithiluAtZOccxt6KTNRwvIiKiH27iflSoRI3SDg=="></script>



    </body>
</html>
