<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="I uvm_predictor is UVM way to determine the value of registers model by monitoring the bus in case someone other than reg model is changing the registers. The usual boilerplate code looks something like this:
predict.map = regmodel.default_map; predict.adapter = reg2rw; // reg2rw is adapter  bus.mon.ap.connect(predict.bus_in); regmodel.default_map.set_auto_predict(0); Looking at the source code, The following important variables bus_in, map and adapter.
`uvm_component_param_utils(uvm_reg_predictor#(BUSTYPE)) // Variable: bus_in  //  // Observed bus transactions of type ~BUSTYPE~ are received from this  // port and processed." />
<meta name="keywords" content=", UVM" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/2023/02/uvm-internals-deepdive-into-uvm_reg_predictor/" />


    <title>
        
            UVM Internals - deepdive into uvm_reg_predictor :: Techiedeepdive 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css">






<meta itemprop="name" content="UVM Internals - deepdive into uvm_reg_predictor">
<meta itemprop="description" content="I uvm_predictor is UVM way to determine the value of registers model by monitoring the bus in case someone other than reg model is changing the registers. The usual boilerplate code looks something like this:
predict.map = regmodel.default_map; predict.adapter = reg2rw; // reg2rw is adapter  bus.mon.ap.connect(predict.bus_in); regmodel.default_map.set_auto_predict(0); Looking at the source code, The following important variables bus_in, map and adapter.
`uvm_component_param_utils(uvm_reg_predictor#(BUSTYPE)) // Variable: bus_in  //  // Observed bus transactions of type ~BUSTYPE~ are received from this  // port and processed."><meta itemprop="datePublished" content="2023-02-11T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-02-11T00:00:00+00:00" />
<meta itemprop="wordCount" content="402"><meta itemprop="image" content=""/>
<meta itemprop="keywords" content="UVM," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>

<meta name="twitter:title" content="UVM Internals - deepdive into uvm_reg_predictor"/>
<meta name="twitter:description" content="I uvm_predictor is UVM way to determine the value of registers model by monitoring the bus in case someone other than reg model is changing the registers. The usual boilerplate code looks something like this:
predict.map = regmodel.default_map; predict.adapter = reg2rw; // reg2rw is adapter  bus.mon.ap.connect(predict.bus_in); regmodel.default_map.set_auto_predict(0); Looking at the source code, The following important variables bus_in, map and adapter.
`uvm_component_param_utils(uvm_reg_predictor#(BUSTYPE)) // Variable: bus_in  //  // Observed bus transactions of type ~BUSTYPE~ are received from this  // port and processed."/>




    <meta property="og:title" content="UVM Internals - deepdive into uvm_reg_predictor" />
<meta property="og:description" content="I uvm_predictor is UVM way to determine the value of registers model by monitoring the bus in case someone other than reg model is changing the registers. The usual boilerplate code looks something like this:
predict.map = regmodel.default_map; predict.adapter = reg2rw; // reg2rw is adapter  bus.mon.ap.connect(predict.bus_in); regmodel.default_map.set_auto_predict(0); Looking at the source code, The following important variables bus_in, map and adapter.
`uvm_component_param_utils(uvm_reg_predictor#(BUSTYPE)) // Variable: bus_in  //  // Observed bus transactions of type ~BUSTYPE~ are received from this  // port and processed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2023/02/uvm-internals-deepdive-into-uvm_reg_predictor/" /><meta property="og:image" content=""/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-02-11T00:00:00+00:00" /><meta property="og:site_name" content="Techiedeepdive" />
<meta property="og:see_also" content="/posts/2023/02/uvm-internals-deepdive-into-uvm_reg_bit_bash_seq/" /><meta property="og:see_also" content="/posts/2023/02/uvm-internals-what-happens-when-you-call-set_auto_predict/" /><meta property="og:see_also" content="/posts/2023/01/uvm-internals-uvm_pool/" /><meta property="og:see_also" content="/posts/2023/01/uvm-internals-uvm_barrier/" /><meta property="og:see_also" content="/posts/2022/09/uvm-internals-objections/" />







    <meta property="article:published_time" content="2023-02-11 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts">Blog</a></li><li><a href="/reading-list/">Reading list</a></li><li><a href="/tags/">Tags</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        2 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="/posts/2023/02/uvm-internals-deepdive-into-uvm_reg_predictor/">UVM Internals - deepdive into uvm_reg_predictor</a>
      </h1>

      

      

      <div class="post-content">
        <p>I
<code>uvm_predictor</code> is UVM way to determine the value of registers model by monitoring the bus in case someone other than reg model is changing the registers. The usual boilerplate code looks something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">        predict.map = regmodel.default_map;
        predict.adapter = reg2rw; <span style="color:#007f7f">// reg2rw is adapter
</span><span style="color:#007f7f"></span>        bus.mon.ap.connect(predict.bus_in);
        regmodel.default_map.set_auto_predict(<span style="color:#ff0;font-weight:bold">0</span>);
</code></pre></div><p>Looking at the source code, The following important variables <code>bus_in</code>, <code>map</code> and <code>adapter</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">
  `uvm_component_param_utils(uvm_reg_predictor#(BUSTYPE))

  <span style="color:#007f7f">// Variable: bus_in
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// Observed bus transactions of type ~BUSTYPE~ are received from this
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// port and processed.
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// For each incoming transaction, the predictor will attempt to get the
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// register or memory handle corresponding to the observed bus address. 
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// If there is a match, the predictor calls the register or memory&#39;s
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// predict method, passing in the observed bus data. The register or
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// memory mirror will be updated with this data, subject to its configured
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// access behavior--RW, RO, WO, etc. The predictor will also convert the
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// bus transaction to a generic &lt;uvm_reg_item&gt; and send it out the
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// ~reg_ap~ analysis port.
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// If the register is wider than the bus, the
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// predictor will collect the multiple bus transactions needed to
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// determine the value being read or written.
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//
</span><span style="color:#007f7f"></span>  uvm_analysis_imp #(BUSTYPE, uvm_reg_predictor #(BUSTYPE)) bus_in;
  
...
...
  <span style="color:#007f7f">// Variable: map
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// The map used to convert a bus address to the corresponding register
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// or memory handle. Must be configured before the run phase.
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// 
</span><span style="color:#007f7f"></span>  uvm_reg_map map;


  <span style="color:#007f7f">// Variable: adapter
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// The adapter used to convey the parameters of a bus operation in 
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// terms of a canonical &lt;uvm_reg_bus_op&gt; datum.
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">// The &lt;uvm_reg_adapter&gt; must be configured before the run phase.
</span><span style="color:#007f7f"></span>  <span style="color:#007f7f">//
</span><span style="color:#007f7f"></span>  uvm_reg_adapter adapter;

</code></pre></div><p>The class has one function <code>write</code> connected to the <code>bus_in</code> analysis imp above.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">  virtual <span style="color:#fff;font-weight:bold">function</span> <span style="color:#fff;font-weight:bold">void</span> write(BUSTYPE tr);
     uvm_reg rg;
     uvm_reg_bus_op rw;
    <span style="color:#fff;font-weight:bold">if</span> (adapter == null)
     `uvm_fatal(<span style="color:#0ff;font-weight:bold">&#34;REG/WRITE/NULL&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;write: adapter handle is null&#34;</span>

</code></pre></div><p>First use adapter to get the rw transaction and look up the register by address</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">     <span style="color:#007f7f">// In case they forget to set byte_en
</span><span style="color:#007f7f"></span>     rw.byte_en = -<span style="color:#ff0;font-weight:bold">1</span>;
     adapter.bus2reg(tr,rw);
     rg = map.get_reg_by_offset(rw.addr, (rw.kind == UVM_READ));
</code></pre></div><p>Next, use the map to get <code>local_map</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">       local_map = rg.get_local_map(map,<span style="color:#0ff;font-weight:bold">&#34;predictor::write()&#34;</span>);
       map_info = local_map.get_reg_map_info(rg);
       ir=($cast(ireg, rg))?ireg.get_indirect_reg():rg;
      ...
      ...
       foreach (map_info.addr[i]) <span style="color:#fff;font-weight:bold">begin</span>
         <span style="color:#fff;font-weight:bold">if</span> (rw.addr == map_info.addr[i]) <span style="color:#fff;font-weight:bold">begin</span>
            found = <span style="color:#ff0;font-weight:bold">1</span>;
           reg_item.value[<span style="color:#ff0;font-weight:bold">0</span>] |= rw.data &lt;&lt; (i * map.get_n_bytes()*<span style="color:#ff0;font-weight:bold">8</span>);
           predict_info.addr[rw.addr] = <span style="color:#ff0;font-weight:bold">1</span>;
           ...
           ...
       <span style="color:#fff;font-weight:bold">end</span>
</code></pre></div><p>And eventually calling RAL function to do the magic</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">              ir.XsampleX(reg_item.value[<span style="color:#ff0;font-weight:bold">0</span>], rw.byte_en,
                          reg_item.kind == UVM_READ, local_map);
              ...
              ...
              ...
              rg.do_predict(reg_item, predict_kind, rw.byte_en);
</code></pre></div>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="tags/uvm/">UVM</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        402 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2023-02-11 00:00 &#43;0000
        

         
          
        
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2023/02/uvm-cheatsheet-sequencer-to-driver-connection/">
                <span class="button__icon">←</span>
                <span class="button__text">UVM cheatsheet - Sequencer to driver connection</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="/posts/2023/02/uvm-internals-deepdive-into-uvm_reg_bit_bash_seq/">
                <span class="button__text">UVM Internals - Deepdive into uvm_reg_bit_bash_seq</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span><span><a href="posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2ce64ea6ea44a72b13dd812fc2eb5cca3efe878cce258a47c137c17edf46e0602a05e422b618a5b80b5939c731b7a293351c2f2222a21f6ee27e54a8448dd20e.js" integrity="sha512-LOZOpupEpysT3YEvwutcyj7&#43;h4zOJYpHwTfBft9G4GAqBeQithiluAtZOccxt6KTNRwvIiKiH27iflSoRI3SDg=="></script>



    </body>
</html>
