<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="A really nice feature of cocotb is force and release which map to RTL force and release depending on the language (and simulator). This is example how to use Force and Release.
from cocotb.handle import Force, Release, Deposit from cocotb.binary import BinaryValue value = &amp;#34;0&amp;#34; sig = .... sig.value = Force(BinaryValue(len(sig) * value) sig.value = Release() Force and Release are defines in handle.py and defines _as_gpi_args_for.
class _SetValueAction(_SetAction): __slots__ = (&amp;#34;value&amp;#34;,) &amp;#34;&amp;#34;&amp;#34;Base class representing the type of action used while write-accessing a handle with a value." />
<meta name="keywords" content=", DV, python, cocotb" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/2023/03/cocotb-deepdive-force-and-release/" />


    <title>
        
            Cocotb Deepdive - Force and release :: Techiedeepdive 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css">






<meta itemprop="name" content="Cocotb Deepdive - Force and release">
<meta itemprop="description" content="A really nice feature of cocotb is force and release which map to RTL force and release depending on the language (and simulator). This is example how to use Force and Release.
from cocotb.handle import Force, Release, Deposit from cocotb.binary import BinaryValue value = &#34;0&#34; sig = .... sig.value = Force(BinaryValue(len(sig) * value) sig.value = Release() Force and Release are defines in handle.py and defines _as_gpi_args_for.
class _SetValueAction(_SetAction): __slots__ = (&#34;value&#34;,) &#34;&#34;&#34;Base class representing the type of action used while write-accessing a handle with a value."><meta itemprop="datePublished" content="2023-03-10T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-03-10T00:00:00+00:00" />
<meta itemprop="wordCount" content="353"><meta itemprop="image" content=""/>
<meta itemprop="keywords" content="DV,python,cocotb," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>

<meta name="twitter:title" content="Cocotb Deepdive - Force and release"/>
<meta name="twitter:description" content="A really nice feature of cocotb is force and release which map to RTL force and release depending on the language (and simulator). This is example how to use Force and Release.
from cocotb.handle import Force, Release, Deposit from cocotb.binary import BinaryValue value = &#34;0&#34; sig = .... sig.value = Force(BinaryValue(len(sig) * value) sig.value = Release() Force and Release are defines in handle.py and defines _as_gpi_args_for.
class _SetValueAction(_SetAction): __slots__ = (&#34;value&#34;,) &#34;&#34;&#34;Base class representing the type of action used while write-accessing a handle with a value."/>




    <meta property="og:title" content="Cocotb Deepdive - Force and release" />
<meta property="og:description" content="A really nice feature of cocotb is force and release which map to RTL force and release depending on the language (and simulator). This is example how to use Force and Release.
from cocotb.handle import Force, Release, Deposit from cocotb.binary import BinaryValue value = &#34;0&#34; sig = .... sig.value = Force(BinaryValue(len(sig) * value) sig.value = Release() Force and Release are defines in handle.py and defines _as_gpi_args_for.
class _SetValueAction(_SetAction): __slots__ = (&#34;value&#34;,) &#34;&#34;&#34;Base class representing the type of action used while write-accessing a handle with a value." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2023/03/cocotb-deepdive-force-and-release/" /><meta property="og:image" content=""/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-03-10T00:00:00+00:00" /><meta property="og:site_name" content="Techiedeepdive" />







    <meta property="article:published_time" content="2023-03-10 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts">Blog</a></li><li><a href="/reading-list/">Reading list</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        2 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="/posts/2023/03/cocotb-deepdive-force-and-release/">Cocotb Deepdive - Force and release</a>
      </h1>

      

      

      <div class="post-content">
        <p>A really nice feature of cocotb is force and release which map to RTL force and release depending on the language (and simulator). This is example how to use <code>Force</code> and <code>Release</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> cocotb.handle <span style="color:#f92672">import</span> Force, Release, Deposit
<span style="color:#f92672">from</span> cocotb.binary <span style="color:#f92672">import</span> BinaryValue

value <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;0&#34;</span>
sig  <span style="color:#f92672">=</span> <span style="color:#f92672">....</span>

sig<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> Force(BinaryValue(len(sig) <span style="color:#f92672">*</span> value)
sig<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> Release()
</code></pre></div><p><code>Force</code> and <code>Release</code> are defines in <code>handle.py</code> and defines <code>_as_gpi_args_for</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">_SetValueAction</span>(_SetAction):
    __slots__ <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#34;value&#34;</span>,)
    <span style="color:#e6db74">&#34;&#34;&#34;Base class representing the type of action used while write-accessing a handle with a value.&#34;&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> __init__(self, value):
        self<span style="color:#f92672">.</span>value <span style="color:#f92672">=</span> value


<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Force</span>(_SetValueAction):
    <span style="color:#e6db74">&#34;&#34;&#34;Action used to force a handle to a given value until a release is applied.&#34;&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_as_gpi_args_for</span>(self, hdl):
        <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>value, <span style="color:#ae81ff">1</span>  <span style="color:#75715e"># GPI_FORCE</span>

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Release</span>(_SetAction):
    <span style="color:#e6db74">&#34;&#34;&#34;Action used to stop the effects of a previously applied force/freeze action.&#34;&#34;&#34;</span>

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_as_gpi_args_for</span>(self, hdl):
        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>  <span style="color:#75715e"># GPI_RELEASE</span>
</code></pre></div><p>Ok, Let&rsquo;s look what happens when testbench calls <code>sig.value = Force(v)</code>. Starting with <code>setter</code> function which calls <code>_set_value</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#a6e22e">@value</span><span style="color:#f92672">.</span>setter
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">value</span>(self, value):
        self<span style="color:#f92672">.</span>_set_value(value, cocotb<span style="color:#f92672">.</span>scheduler<span style="color:#f92672">.</span>_schedule_write)
</code></pre></div><p>For integer, <code>IntegerObject</code> calls <code>_check_for_set_action</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IntegerObject</span>(ModifiableObject):

        value, set_action <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>_check_for_set_action(value)
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_set_value</span>(self, value, call_sim):
        <span style="color:#f92672">...</span>


         call_sim(self, self<span style="color:#f92672">.</span>_handle<span style="color:#f92672">.</span>set_signal_val_int, set_action, value)
</code></pre></div><p>And <code>_check_for_set_action</code> calls <code>_as_gpi_args_for</code> to get type of action and pass it down to simulator.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">_check_for_set_action</span>(self, value):
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> isinstance(value, _SetAction):
            <span style="color:#66d9ef">return</span> value, <span style="color:#ae81ff">0</span>  <span style="color:#75715e"># GPI_DEPOSIT</span>
        <span style="color:#66d9ef">return</span> value<span style="color:#f92672">.</span>_as_gpi_args_for(self)
</code></pre></div><p>well, Several layers(gpi and stuff), there are several implementations of force(FLI/VHPI and VPI). This is snippet from the vpi <code>set_signal_value</code>. <code>vpiForceFlag</code> is passed to <code>vpi_put_value</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#66d9ef">int</span> VpiSignalObjHdl<span style="color:#f92672">::</span>set_signal_value(s_vpi_value value_s,
                                      gpi_set_action_t action) {
    PLI_INT32 vpi_put_flag <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
    s_vpi_time vpi_time_s;

    vpi_time_s.type <span style="color:#f92672">=</span> vpiSimTime;
    vpi_time_s.high <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    vpi_time_s.low <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;

    <span style="color:#66d9ef">switch</span> (action) {
        <span style="color:#66d9ef">case</span> GPI_DEPOSIT:
            <span style="color:#66d9ef">if</span> (vpiStringVar <span style="color:#f92672">==</span>
                vpi_get(vpiType, GpiObjHdl<span style="color:#f92672">::</span>get_handle<span style="color:#f92672">&lt;</span>vpiHandle<span style="color:#f92672">&gt;</span>())) {
                <span style="color:#75715e">// assigning to a vpiStringVar only seems to work with
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// vpiNoDelay
</span><span style="color:#75715e"></span>                vpi_put_flag <span style="color:#f92672">=</span> vpiNoDelay;
            } <span style="color:#66d9ef">else</span> {
                <span style="color:#75715e">// Use Inertial delay to schedule an event, thus behaving like a
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// verilog testbench
</span><span style="color:#75715e"></span>                vpi_put_flag <span style="color:#f92672">=</span> vpiInertialDelay;
            }
            <span style="color:#66d9ef">break</span>;
        <span style="color:#66d9ef">case</span> GPI_FORCE:
            vpi_put_flag <span style="color:#f92672">=</span> vpiForceFlag;
            <span style="color:#66d9ef">break</span>;
        <span style="color:#66d9ef">case</span> GPI_RELEASE:
            <span style="color:#75715e">// Best to pass its current value to the sim when releasing
</span><span style="color:#75715e"></span>            vpi_get_value(GpiObjHdl<span style="color:#f92672">::</span>get_handle<span style="color:#f92672">&lt;</span>vpiHandle<span style="color:#f92672">&gt;</span>(), <span style="color:#f92672">&amp;</span>value_s);
            vpi_put_flag <span style="color:#f92672">=</span> vpiReleaseFlag;
            <span style="color:#66d9ef">break</span>;
        <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
            assert(<span style="color:#ae81ff">0</span>);
    }

    <span style="color:#66d9ef">if</span> (vpi_put_flag <span style="color:#f92672">==</span> vpiNoDelay) {
        vpi_put_value(GpiObjHdl<span style="color:#f92672">::</span>get_handle<span style="color:#f92672">&lt;</span>vpiHandle<span style="color:#f92672">&gt;</span>(), <span style="color:#f92672">&amp;</span>value_s, NULL,
                      vpiNoDelay);
    } <span style="color:#66d9ef">else</span> {
        vpi_put_value(GpiObjHdl<span style="color:#f92672">::</span>get_handle<span style="color:#f92672">&lt;</span>vpiHandle<span style="color:#f92672">&gt;</span>(), <span style="color:#f92672">&amp;</span>value_s, <span style="color:#f92672">&amp;</span>vpi_time_s,
                      vpi_put_flag);
    }

</code></pre></div>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="tags/dv/">DV</a></span>
        <span class="tag"><a href="tags/python/">python</a></span>
        <span class="tag"><a href="tags/cocotb/">cocotb</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        353 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2023-03-10 00:00 &#43;0000
        

         
          
        
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2023/03/crypto-dh-key-exchange/">
                <span class="button__icon">←</span>
                <span class="button__text">Crypto - DH key exchange</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="/posts/2023/03/yosys-python-bindings-pyosys-hello-world-and-deepdive/">
                <span class="button__text">Yosys Python bindings pyosys - Hello world and deepdive</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span><span><a href="posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2ce64ea6ea44a72b13dd812fc2eb5cca3efe878cce258a47c137c17edf46e0602a05e422b618a5b80b5939c731b7a293351c2f2222a21f6ee27e54a8448dd20e.js" integrity="sha512-LOZOpupEpysT3YEvwutcyj7&#43;h4zOJYpHwTfBft9G4GAqBeQithiluAtZOccxt6KTNRwvIiKiH27iflSoRI3SDg=="></script>



    </body>
</html>
