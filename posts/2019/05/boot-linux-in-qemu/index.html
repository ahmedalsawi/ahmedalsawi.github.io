<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="This is quick guide to compile linux kernel and minimal boot in Qemu.
Compiling linux kernel To compile linux kernel, you will need .config to configure the build. To generate default .config:
make defconfig if you are planning to upgrade the kernel version on your machine, you need to use the current config to generate compatible configuration
cp /boot/config-`kernel version` ./config make oldconfig Creating busybox initramfs mkinitramfs creates minimal busybox file system with busybox unix commands." />
<meta name="keywords" content=", qemu" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/2019/05/boot-linux-in-qemu/" />


    <title>
        
            Boot linux in Qemu :: Techiedeepdive 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css">






<meta itemprop="name" content="Boot linux in Qemu">
<meta itemprop="description" content="This is quick guide to compile linux kernel and minimal boot in Qemu.
Compiling linux kernel To compile linux kernel, you will need .config to configure the build. To generate default .config:
make defconfig if you are planning to upgrade the kernel version on your machine, you need to use the current config to generate compatible configuration
cp /boot/config-`kernel version` ./config make oldconfig Creating busybox initramfs mkinitramfs creates minimal busybox file system with busybox unix commands."><meta itemprop="datePublished" content="2019-05-11T00:00:00+00:00" />
<meta itemprop="dateModified" content="2019-05-11T00:00:00+00:00" />
<meta itemprop="wordCount" content="197"><meta itemprop="image" content=""/>
<meta itemprop="keywords" content="qemu," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>

<meta name="twitter:title" content="Boot linux in Qemu"/>
<meta name="twitter:description" content="This is quick guide to compile linux kernel and minimal boot in Qemu.
Compiling linux kernel To compile linux kernel, you will need .config to configure the build. To generate default .config:
make defconfig if you are planning to upgrade the kernel version on your machine, you need to use the current config to generate compatible configuration
cp /boot/config-`kernel version` ./config make oldconfig Creating busybox initramfs mkinitramfs creates minimal busybox file system with busybox unix commands."/>




    <meta property="og:title" content="Boot linux in Qemu" />
<meta property="og:description" content="This is quick guide to compile linux kernel and minimal boot in Qemu.
Compiling linux kernel To compile linux kernel, you will need .config to configure the build. To generate default .config:
make defconfig if you are planning to upgrade the kernel version on your machine, you need to use the current config to generate compatible configuration
cp /boot/config-`kernel version` ./config make oldconfig Creating busybox initramfs mkinitramfs creates minimal busybox file system with busybox unix commands." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2019/05/boot-linux-in-qemu/" /><meta property="og:image" content=""/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-05-11T00:00:00+00:00" /><meta property="og:site_name" content="Techiedeepdive" />







    <meta property="article:published_time" content="2019-05-11 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts">Blog</a></li><li><a href="/reading-list/">Reading list</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        One minute

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="/posts/2019/05/boot-linux-in-qemu/">Boot linux in Qemu</a>
      </h1>

      

      

      <div class="post-content">
        <p>This is quick guide to compile linux kernel and minimal boot in Qemu.</p>
<h1 id="compiling-linux-kernel">Compiling linux kernel</h1>
<p>To compile linux kernel, you will need <code>.config</code> to configure the build. To generate default <code>.config</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">make defconfig
</code></pre></div><p>if you are planning to upgrade the kernel version on your machine, you need to use the current config to generate compatible configuration</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp /boot/config-<span style="color:#e6db74">`</span>kernel version<span style="color:#e6db74">`</span> ./config
make oldconfig
</code></pre></div><h1 id="creating-busybox-initramfs">Creating busybox initramfs</h1>
<p><code>mkinitramfs</code> creates minimal busybox file system with busybox unix commands.
More importantly, the kernel will try to mount root file system by default.So, you will get kernel panic if kernel didn&rsquo;t find one.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkinitramfs -o initrd.img
</code></pre></div><h1 id="booting-qemu">Booting qemu</h1>
<p>Using <code>qemu-system-x86_64</code> which is vanilla qemu (No KVM)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">qemu-system-x86_64 -kernel ./arch/x86_64/boot/bzImage -initrd initrd.img -m <span style="color:#ae81ff">2048</span> -nographic -append <span style="color:#e6db74">&#34;console=ttyS0&#34;</span>
</code></pre></div><p>After boot messages, you should see something like:</p>
<pre tabindex="0"><code>[    5.916979] ata_id (1021) used greatest stack depth: 14128 bytes left

...
...


BusyBox v1.27.2 (Ubuntu 1:1.27.2-2ubuntu3.2) built-in shell (ash)
Enter 'help' for a list of built-in commands.

(initramfs) uname -a
Linux (none) 4.15.0-rc6+ #12 SMP Sat May 11 11:09:29 EET 2019 x86_64 GNU/Linux
</code></pre><h1 id="moving-between-console-and-qemu-monitor">Moving between console and qemu monitor</h1>
<p>To reboot qemu, you can move to qemu monitor by <code>Ctrl-a</code> then <code>c</code></p>
<h1 id="references">References</h1>
<ul>
<li><a href="https://nostillsearching.wordpress.com/2012/09/22/compiling-linux-kernel-and-running-it-using-qemu/">https://nostillsearching.wordpress.com/2012/09/22/compiling-linux-kernel-and-running-it-using-qemu/</a></li>
<li><a href="https://www.zachpfeffer.com/single-post/Build-the-Linux-kernel-and-Busybox-and-run-on-QEMU">https://www.zachpfeffer.com/single-post/Build-the-Linux-kernel-and-Busybox-and-run-on-QEMU</a></li>
<li><a href="http://manpages.ubuntu.com/manpages/bionic/man8/mkinitramfs.8.html">http://manpages.ubuntu.com/manpages/bionic/man8/mkinitramfs.8.html</a></li>
</ul>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="tags/qemu/">qemu</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        197 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2019-05-11 01:00 &#43;0100
        

         
          
        
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2019/06/web-scraping-with-python/">
                <span class="button__icon">←</span>
                <span class="button__text">Web scraping with python</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="/posts/2019/05/console-boot-options-in-linux/">
                <span class="button__text">Console boot options in linux</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span><span><a href="posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2ce64ea6ea44a72b13dd812fc2eb5cca3efe878cce258a47c137c17edf46e0602a05e422b618a5b80b5939c731b7a293351c2f2222a21f6ee27e54a8448dd20e.js" integrity="sha512-LOZOpupEpysT3YEvwutcyj7&#43;h4zOJYpHwTfBft9G4GAqBeQithiluAtZOccxt6KTNRwvIiKiH27iflSoRI3SDg=="></script>



    </body>
</html>
