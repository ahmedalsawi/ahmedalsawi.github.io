<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  Bitbake Tutorial · Techiedeepdive
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="description" content="
  Introdction
  
    
    Link to heading
  

Bitbake is make-like build system. It was a part of openembedded project but split at some point to function as task runner.
This is small working exaple of bitbake layer. I extracted it from docs and Yocto-poky repo.

  Installation
  
    
    Link to heading
  

Download git repo from git. and set PATH to bitbake/bin. that&rsquo;s it :)

  Basic concepts
  
    
    Link to heading
  

Bitbake uses recipes to control how to build software packages. Recipes can be grouped in layer.It is useful to isolate related recipes into separate layer. And you can add customization or more recipes with additional layers.">
<meta name="keywords" content="homepage, blog">



  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="/">
  <meta name="twitter:title" content="Bitbake Tutorial">
  <meta name="twitter:description" content="Introdction Link to heading Bitbake is make-like build system. It was a part of openembedded project but split at some point to function as task runner.
This is small working exaple of bitbake layer. I extracted it from docs and Yocto-poky repo.
Installation Link to heading Download git repo from git. and set PATH to bitbake/bin. that’s it :)
Basic concepts Link to heading Bitbake uses recipes to control how to build software packages. Recipes can be grouped in layer.It is useful to isolate related recipes into separate layer. And you can add customization or more recipes with additional layers.">

<meta property="og:url" content="/posts/2020/07/bitbake-tutorial/">
  <meta property="og:site_name" content="Techiedeepdive">
  <meta property="og:title" content="Bitbake Tutorial">
  <meta property="og:description" content="Introdction Link to heading Bitbake is make-like build system. It was a part of openembedded project but split at some point to function as task runner.
This is small working exaple of bitbake layer. I extracted it from docs and Yocto-poky repo.
Installation Link to heading Download git repo from git. and set PATH to bitbake/bin. that’s it :)
Basic concepts Link to heading Bitbake uses recipes to control how to build software packages. Recipes can be grouped in layer.It is useful to isolate related recipes into separate layer. And you can add customization or more recipes with additional layers.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-07-03T16:47:59+02:00">
    <meta property="article:modified_time" content="2020-07-03T16:47:59+02:00">
    <meta property="article:tag" content="Embedded">
    <meta property="og:image" content="/">




<link rel="canonical" href="/posts/2020/07/bitbake-tutorial/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.aa5ef26fa979d6793724ae2dbd71efa94fd16cb1c5c7db3b6651f21f9892a5fd.css" integrity="sha256-ql7yb6l51nk3JK4tvXHvqU/RbLHFx9s7ZlHyH5iSpf0=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="/">
      Techiedeepdive
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/reading-list/">Reading list</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/tags/">Tags</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="/posts/2020/07/bitbake-tutorial/">
              Bitbake Tutorial
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2020-07-03T16:47:59&#43;02:00">
                July 3, 2020
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/embedded/">Embedded</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <h1 id="introdction">
  Introdction
  <a class="heading-link" href="#introdction">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Bitbake is make-like build system. It was a part of openembedded project but split at some point to function as task runner.</p>
<p>This is small working exaple of bitbake layer. I extracted it from <a href="https://www.yoctoproject.org/docs/1.6/bitbake-user-manual/bitbake-user-manual.html"  class="external-link" target="_blank" rel="noopener">docs</a> and Yocto-poky repo.</p>
<h1 id="installation">
  Installation
  <a class="heading-link" href="#installation">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Download git repo from <a href="https://github.com/openembedded/bitbake"  class="external-link" target="_blank" rel="noopener">git</a>. and set PATH to <code>bitbake/bin</code>. that&rsquo;s it :)</p>
<h1 id="basic-concepts">
  Basic concepts
  <a class="heading-link" href="#basic-concepts">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>Bitbake uses <code>recipes</code> to control how to build software packages. Recipes can be grouped in <code>layer</code>.It is useful to isolate related recipes into separate layer. And you can add customization or more recipes with additional layers.</p>
<p>This is the structure of bitbake &ldquo;Hello world&rdquo;</p>
<pre tabindex="0"><code>├── conf
│   └── bblayers.conf
└── layer1
    ├── classes
    │   └── base.bbclass
    ├── conf
    │   ├── bitbake.conf
    │   └── layer.conf
    └── recipes
        └── coolpkg
            └── coolpkg.bb
</code></pre><h2 id="bblayer-configuration">
  bblayer Configuration
  <a class="heading-link" href="#bblayer-configuration">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>To run bitbake, it needs to parse configuration files from <code>conf</code> directory in <code>$PWD</code>. It has to include at least  <code>bblayers.conf</code>. <code>bblayers.conf</code> points bitbake to the layers.</p>
<p>The smallest <code>bblayers.conf</code> just sets <code>BBPATH</code> and <code>BBLAYERS</code>.</p>
<pre tabindex="0"><code>BBPATH = &#34;${TOPDIR}&#34;

BBLAYERS = &#34; \
    ${TOPDIR}/layer1 \
&#34;
</code></pre><p>Note, <code>TOPDIR</code> is an internal variable in Bitbake.</p>
<h2 id="bitbake-configuration">
  bitbake configuration
  <a class="heading-link" href="#bitbake-configuration">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><code>bitbake.conf</code> provides configuration meta data for all recipes. <code>cond/bitbake.conf</code> is expected to be somewhere under <code>BBPATH</code>.</p>
<p>The following <code>bitbake.conf</code> adds the minimal configuration for a working bitbake setup.</p>
<pre tabindex="0"><code>TMPDIR ?= &#34;${TOPDIR}/tmp&#34;
CACHE = &#34;${TMPDIR}/cache&#34;
PERSISTENT_DIR = &#34;${TOPDIR}/cache&#34;
STAMPS_DIR ?= &#34;${TMPDIR}/stamps&#34;
STAMP = &#34;${STAMPS_DIR}/pkg1&#34;
BASE_WORKDIR ?= &#34;${TMPDIR}/work&#34;
WORKDIR = &#34;${BASE_WORKDIR}/pkg1&#34;

T = &#34;${WORKDIR}/temp&#34;
</code></pre><p>The above configuration would normally depend on the layer/recipes running at a given point but for simplicity I used fixed paths.</p>
<h2 id="layer">
  layer
  <a class="heading-link" href="#layer">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>layer is a directory that contains related recipes. It has to contain <code>conf/layer.conf</code></p>
<p><code>layer.conf</code> has to  update <code>BBPATH</code> and <code>BBFILES</code> with files in that layer.</p>
<pre tabindex="0"><code>BBPATH =. &#34;${LAYERDIR}:&#34;
BBFILES = &#34;${LAYERDIR}/recipes/*/*.bb&#34;
</code></pre><p>Note, <code>${LAYERDIR}</code> variable can be used to reference current layer.</p>
<h2 id="classes">
  classes
  <a class="heading-link" href="#classes">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>layer should contain <code>classes/base.bbclass</code>. It defines the tasks for recipes in that layer. Note that default  bitbake task is <code>build</code>. So, we have to provide that in base.bbclass. Also, bitbake adds <code>do_</code> before each task. So, that function has be called <code>do_build</code>.</p>
<p>Minimal <code>base.bbclass</code></p>
<pre tabindex="0"><code>addtask build
do_build () {
    :
}
</code></pre><p>Note, the build task contains <code>:</code> because recipe will provide <code>do_build</code>. if recipe doesn&rsquo;t provide build task, do_build from <code>base.bbclass</code> will be called.</p>
<h2 id="recipes">
  recipes
  <a class="heading-link" href="#recipes">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>recipe is a file with extension  <code>.bb</code>. It implicitly inherit from <code>base.bbclass</code>. so, it provides implementation for tasks like <code>do_build</code>.</p>
<pre tabindex="0"><code>SUMMARY = &#34;First Recipe&#34;
python do_build(){
    print(&#34;Hello world from coolpkg:do_build&#34;)
}
</code></pre><h1 id="hello-world">
  Hello World
  <a class="heading-link" href="#hello-world">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>we are ready for &ldquo;Hello World&rdquo;, just do <code>bitbake world</code></p>
<pre tabindex="0"><code>Loading cache: 100% |                                                             | ETA:  --:--:--
Loaded 0 entries from dependency cache.
Parsing recipes: 100% |############################################################| Time: 0:00:00
Parsing of 1 .bb files complete (0 cached, 1 parsed). 1 targets, 0 skipped, 0 masked, 0 errors.
NOTE: Resolving any missing task queue dependencies
Initialising tasks: 100% |#########################################################| Time: 0:00:00
NOTE: No setscene tasks
NOTE: Executing Tasks
NOTE: Tasks Summary: Attempted 1 tasks of which 0 didn&#39;t need to be rerun and all succeeded.
</code></pre><p>You can see the output in <code>tmp/work/log.do_build</code></p>
<pre tabindex="0"><code>DEBUG: Executing python function do_build
DEBUG: Python function do_build finished
Hello world from coolpkg:do_build
</code></pre>
      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2024
    
    ·
    
      Licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA-4.0</a>
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
