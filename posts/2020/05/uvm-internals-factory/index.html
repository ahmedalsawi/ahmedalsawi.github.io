<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="The White Rabbit The factory is a way to dynamically construct objects(see wiki). For UVM, Factory can be used to override the objected created which allow injection of new functionality into already existing sequences.
It requires registering the class first then using create to get an object
 registration  class env extends uvm_env; `uvm_component_utils(uvm_env)  Creation  env = uvm_env::type_id::create(&amp;#34;env&amp;#34;,this); Registration uvm_component_utils is defined in src/macros/uvm_object_defines.svh
`define uvm_component_utils(T) \ `m_uvm_component_registry_internal(T,T) \ `m_uvm_get_type_name_func(T) \ let&amp;rsquo;s start with m_uvm_get_type_name_func which simply defines the type_name by stringify the T" />
<meta name="keywords" content=", UVM" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/2020/05/uvm-internals-factory/" />


    <title>
        
            UVM Internals - Factory :: Techiedeepdive 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css">






<meta itemprop="name" content="UVM Internals - Factory">
<meta itemprop="description" content="The White Rabbit The factory is a way to dynamically construct objects(see wiki). For UVM, Factory can be used to override the objected created which allow injection of new functionality into already existing sequences.
It requires registering the class first then using create to get an object
 registration  class env extends uvm_env; `uvm_component_utils(uvm_env)  Creation  env = uvm_env::type_id::create(&#34;env&#34;,this); Registration uvm_component_utils is defined in src/macros/uvm_object_defines.svh
`define uvm_component_utils(T) \ `m_uvm_component_registry_internal(T,T) \ `m_uvm_get_type_name_func(T) \ let&rsquo;s start with m_uvm_get_type_name_func which simply defines the type_name by stringify the T"><meta itemprop="datePublished" content="2020-05-01T00:00:00+00:00" />
<meta itemprop="dateModified" content="2020-05-01T00:00:00+00:00" />
<meta itemprop="wordCount" content="392"><meta itemprop="image" content=""/>
<meta itemprop="keywords" content="UVM," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>

<meta name="twitter:title" content="UVM Internals - Factory"/>
<meta name="twitter:description" content="The White Rabbit The factory is a way to dynamically construct objects(see wiki). For UVM, Factory can be used to override the objected created which allow injection of new functionality into already existing sequences.
It requires registering the class first then using create to get an object
 registration  class env extends uvm_env; `uvm_component_utils(uvm_env)  Creation  env = uvm_env::type_id::create(&#34;env&#34;,this); Registration uvm_component_utils is defined in src/macros/uvm_object_defines.svh
`define uvm_component_utils(T) \ `m_uvm_component_registry_internal(T,T) \ `m_uvm_get_type_name_func(T) \ let&rsquo;s start with m_uvm_get_type_name_func which simply defines the type_name by stringify the T"/>




    <meta property="og:title" content="UVM Internals - Factory" />
<meta property="og:description" content="The White Rabbit The factory is a way to dynamically construct objects(see wiki). For UVM, Factory can be used to override the objected created which allow injection of new functionality into already existing sequences.
It requires registering the class first then using create to get an object
 registration  class env extends uvm_env; `uvm_component_utils(uvm_env)  Creation  env = uvm_env::type_id::create(&#34;env&#34;,this); Registration uvm_component_utils is defined in src/macros/uvm_object_defines.svh
`define uvm_component_utils(T) \ `m_uvm_component_registry_internal(T,T) \ `m_uvm_get_type_name_func(T) \ let&rsquo;s start with m_uvm_get_type_name_func which simply defines the type_name by stringify the T" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2020/05/uvm-internals-factory/" /><meta property="og:image" content=""/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-05-01T00:00:00+00:00" /><meta property="og:site_name" content="Techiedeepdive" />
<meta property="og:see_also" content="/posts/2023/02/uvm-internals-deepdive-into-uvm_reg_predictor/" /><meta property="og:see_also" content="/posts/2023/02/uvm-internals-deepdive-into-uvm_reg_bit_bash_seq/" /><meta property="og:see_also" content="/posts/2023/02/uvm-internals-what-happens-when-you-call-set_auto_predict/" /><meta property="og:see_also" content="/posts/2023/01/uvm-internals-uvm_pool/" /><meta property="og:see_also" content="/posts/2023/01/uvm-internals-uvm_barrier/" /><meta property="og:see_also" content="/posts/2022/09/uvm-internals-objections/" />







    <meta property="article:published_time" content="2020-05-01 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts">Blog</a></li><li><a href="/reading-list/">Reading list</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        2 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="/posts/2020/05/uvm-internals-factory/">UVM Internals - Factory</a>
      </h1>

      

      

      <div class="post-content">
        <h1 id="the-white-rabbit">The White Rabbit</h1>
<p>The factory is a way to dynamically construct objects(see wiki). For UVM, Factory can be used to override the objected created which allow <code>injection</code> of new functionality into already existing sequences.</p>
<p>It requires registering the class first then using <code>create</code> to get an object</p>
<ul>
<li>registration</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">class env extends uvm_env;
 <span style="color:#66d9ef">`uvm_component_utils</span>(uvm_env)
</code></pre></div><ul>
<li>Creation</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">env <span style="color:#f92672">=</span> uvm_env<span style="color:#f92672">::</span>type_id<span style="color:#f92672">::</span>create(<span style="color:#e6db74">&#34;env&#34;</span>,this);
</code></pre></div><h2 id="registration">Registration</h2>
<p><code>uvm_component_utils</code> is defined in <code>src/macros/uvm_object_defines.svh</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#75715e">`define uvm_component_utils(T) \
</span><span style="color:#75715e">   `m_uvm_component_registry_internal(T,T) \
</span><span style="color:#75715e">   `m_uvm_get_type_name_func(T) \
</span></code></pre></div><p>let&rsquo;s start with <code>m_uvm_get_type_name_func</code> which simply defines the <code>type_name</code> by stringify the <code>T</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#75715e">`define m_uvm_get_type_name_func(T) \
</span><span style="color:#75715e">   const static string type_name = `&#34;T`&#34;; \
</span><span style="color:#75715e">   virtual function string get_type_name (); \
</span><span style="color:#75715e">     return type_name; \
</span><span style="color:#75715e">   endfunction
</span></code></pre></div><p>Then <code>m_uvm_component_registry_internal</code> just adds <code>type_id</code>  type which is going to be called to create the object. (the protagonist)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#75715e">`define m_uvm_component_registry_internal(T,S) \
</span><span style="color:#75715e">   typedef uvm_component_registry #(T,`&#34;S`&#34;) type_id; \
</span><span style="color:#75715e">   static function type_id get_type(); \
</span><span style="color:#75715e">     return type_id::get(); \
</span><span style="color:#75715e">   endfunction \
</span><span style="color:#75715e">   virtual function uvm_object_wrapper get_object_type(); \
</span><span style="color:#75715e">     return type_id::get(); \
</span><span style="color:#75715e">   endfunction
</span></code></pre></div><h1 id="initialization">Initialization</h1>
<p>It&rsquo;s clear that the heavy stuff is done by <code>uvm_component_registry::create</code> but first looking at <code>get</code> in <code>src/base/uvm_registry.svh</code>, <code>get</code> returns <code>me</code> if initialized. but <code>me</code> is static and already initialized before any create is called.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">  local static this_type me <span style="color:#f92672">=</span> get();


  <span style="color:#75715e">// Function: get
</span><span style="color:#75715e"></span>  <span style="color:#75715e">//
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// Returns the singleton instance of this type. Type-based factory operation
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// depends on there being a single proxy instance for each registered type. 
</span><span style="color:#75715e"></span>
  static <span style="color:#66d9ef">function</span> this_type get();
    <span style="color:#66d9ef">if</span> (me <span style="color:#f92672">==</span> null) <span style="color:#66d9ef">begin</span>
      uvm_factory f <span style="color:#f92672">=</span> uvm_factory<span style="color:#f92672">::</span>get();
      me <span style="color:#f92672">=</span> new;
      f.register(me);
    <span style="color:#66d9ef">end</span>
    <span style="color:#66d9ef">return</span> me;
  <span style="color:#66d9ef">endfunction</span>
</code></pre></div><p>in <code>get</code> above, the factory singleton is created as well(if not already). so in <code>src/base/uvm_factory.svh</code>, <code>get</code> is defined.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#66d9ef">function</span> uvm_factory uvm_factory<span style="color:#f92672">::</span>get();
  <span style="color:#66d9ef">if</span> (m_inst <span style="color:#f92672">==</span> null) <span style="color:#66d9ef">begin</span>
    m_inst <span style="color:#f92672">=</span> new();
  <span style="color:#66d9ef">end</span>
  <span style="color:#66d9ef">return</span> m_inst;
<span style="color:#66d9ef">endfunction</span>
</code></pre></div><h1 id="creation">Creation</h1>
<p>To create the component, in build phase the <code>type_id::create</code> is called</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">env <span style="color:#f92672">=</span> uvm_env<span style="color:#f92672">::</span>type_id<span style="color:#f92672">::</span>create(<span style="color:#e6db74">&#34;env&#34;</span>,this);
</code></pre></div><p><code>create</code> in <code>src/base/uvm_registry.svh</code>, calls <code>create_component_by_type</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">  static <span style="color:#66d9ef">function</span> T create (<span style="color:#66d9ef">string</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>, uvm_component parent<span style="color:#f92672">=</span>null,
                            <span style="color:#66d9ef">string</span> contxt<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>);
    uvm_object obj;
    uvm_factory f <span style="color:#f92672">=</span> uvm_factory<span style="color:#f92672">::</span>get();
    ...
    ...
    obj <span style="color:#f92672">=</span> f.create_object_by_type(get(),contxt,name);
    ...
    ...
  <span style="color:#66d9ef">endfunction</span>
</code></pre></div><p><code>create_component_by_type</code> first calls <code>find_override_by_type</code> which checks for override. if there is no override, it returns <code>requested_type</code> as is.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog"><span style="color:#66d9ef">function</span> uvm_object uvm_factory<span style="color:#f92672">::</span>create_object_by_type (uvm_object_wrapper requested_type,  
                                                        <span style="color:#66d9ef">string</span> parent_inst_path<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>,  
                                                        <span style="color:#66d9ef">string</span> name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;&#34;</span>); 

...
...

  requested_type <span style="color:#f92672">=</span> find_override_by_type(requested_type, full_inst_path);

  <span style="color:#66d9ef">return</span> requested_type.create_object(name);

<span style="color:#66d9ef">endfunction</span>
</code></pre></div><p>Finally <code>create_component_by_type</code> calls <code>create_component</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">  <span style="color:#66d9ef">return</span> requested_type.create_component(name, parent);
</code></pre></div><p><code>create_component</code> is picked up from requested_type which is <code>uvm_component_registry</code>
and it calls <code>new</code> to create the object</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-verilog" data-lang="verilog">virtual <span style="color:#66d9ef">function</span> uvm_component create_component (<span style="color:#66d9ef">string</span> name,
                                                   uvm_component parent);
    T obj;
    obj <span style="color:#f92672">=</span> new(name, parent);
    <span style="color:#66d9ef">return</span> obj;
  <span style="color:#66d9ef">endfunction</span>
</code></pre></div>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="tags/uvm/">UVM</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        392 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2020-05-01 01:00 &#43;0100
        

         
          
        
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2020/05/uvm-internals-reporting/">
                <span class="button__icon">←</span>
                <span class="button__text">UVM Internals - Reporting</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="/posts/2020/04/uvm-internals-run_test/">
                <span class="button__text">UVM Internals - run_test</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span><span><a href="posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2ce64ea6ea44a72b13dd812fc2eb5cca3efe878cce258a47c137c17edf46e0602a05e422b618a5b80b5939c731b7a293351c2f2222a21f6ee27e54a8448dd20e.js" integrity="sha512-LOZOpupEpysT3YEvwutcyj7&#43;h4zOJYpHwTfBft9G4GAqBeQithiluAtZOccxt6KTNRwvIiKiH27iflSoRI3SDg=="></script>



    </body>
</html>
