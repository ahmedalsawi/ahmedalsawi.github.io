<!DOCTYPE html>
<html lang="en">

<head>
  <title>
  HFT - ITCH protocol primer · Techiedeepdive
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="description" content="I have been dabbling with HFT for few weeks now. So, I thought to go through of the protocols such ITCH and OUCH. This post is about ITCH

Nasdaq TotalView ITCH is a direct data feed product offered by The Nasdaq Stock Market, LLC. This specification covers
both the software and hardware (FPGA) versions of the feed.

Nasdaq will broadcast the TotalView ITCH FPGA feed from the U.S. primary data center facility in Carteret,
New Jersey in the MoldUDP64 protocol option only. Given the unshaped network traffic, Nasdaq is requiring firms to
have 10 Gb or 40 Gb network connection into the Carteret, NJ data center to obtain the TotalView ITCH FPGA feed.
As with the software version of the feed, the TotalView ITCH FPGA feed will be comprised of a series of sequenced
order messages. Outside of the fact that the FPGA data delivery is unthrottled or unshaped at the network level, the
TotalView-•-ITCH payload will be the same for both versions of the TotalView-•-ITCH 5.0 data formats. TotalView ITCH
FPGA product is guaranteed to disseminate payload messages in the same exact order as the software-•-based version
of the TotalView ITCH feed.">
<meta name="keywords" content="homepage, blog">



  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="/">
  <meta name="twitter:title" content="HFT - ITCH protocol primer">
  <meta name="twitter:description" content="I have been dabbling with HFT for few weeks now. So, I thought to go through of the protocols such ITCH and OUCH. This post is about ITCH
Nasdaq TotalView ITCH is a direct data feed product offered by The Nasdaq Stock Market, LLC. This specification covers both the software and hardware (FPGA) versions of the feed.
Nasdaq will broadcast the TotalView ITCH FPGA feed from the U.S. primary data center facility in Carteret, New Jersey in the MoldUDP64 protocol option only. Given the unshaped network traffic, Nasdaq is requiring firms to have 10 Gb or 40 Gb network connection into the Carteret, NJ data center to obtain the TotalView ITCH FPGA feed. As with the software version of the feed, the TotalView ITCH FPGA feed will be comprised of a series of sequenced order messages. Outside of the fact that the FPGA data delivery is unthrottled or unshaped at the network level, the TotalView-•-ITCH payload will be the same for both versions of the TotalView-•-ITCH 5.0 data formats. TotalView ITCH FPGA product is guaranteed to disseminate payload messages in the same exact order as the software-•-based version of the TotalView ITCH feed.">

<meta property="og:url" content="/posts/2025/06/hft-itch-protocol-primer/">
  <meta property="og:site_name" content="Techiedeepdive">
  <meta property="og:title" content="HFT - ITCH protocol primer">
  <meta property="og:description" content="I have been dabbling with HFT for few weeks now. So, I thought to go through of the protocols such ITCH and OUCH. This post is about ITCH
Nasdaq TotalView ITCH is a direct data feed product offered by The Nasdaq Stock Market, LLC. This specification covers both the software and hardware (FPGA) versions of the feed.
Nasdaq will broadcast the TotalView ITCH FPGA feed from the U.S. primary data center facility in Carteret, New Jersey in the MoldUDP64 protocol option only. Given the unshaped network traffic, Nasdaq is requiring firms to have 10 Gb or 40 Gb network connection into the Carteret, NJ data center to obtain the TotalView ITCH FPGA feed. As with the software version of the feed, the TotalView ITCH FPGA feed will be comprised of a series of sequenced order messages. Outside of the fact that the FPGA data delivery is unthrottled or unshaped at the network level, the TotalView-•-ITCH payload will be the same for both versions of the TotalView-•-ITCH 5.0 data formats. TotalView ITCH FPGA product is guaranteed to disseminate payload messages in the same exact order as the software-•-based version of the TotalView ITCH feed.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-06-12T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-06-12T00:00:00+00:00">
    <meta property="article:tag" content="Hft">
    <meta property="og:image" content="/">




<link rel="canonical" href="/posts/2025/06/hft-itch-protocol-primer/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.aa5ef26fa979d6793724ae2dbd71efa94fd16cb1c5c7db3b6651f21f9892a5fd.css" integrity="sha256-ql7yb6l51nk3JK4tvXHvqU/RbLHFx9s7ZlHyH5iSpf0=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.a00e6364bacbc8266ad1cc81230774a1397198f8cfb7bcba29b7d6fcb54ce57f.css" integrity="sha256-oA5jZLrLyCZq0cyBIwd0oTlxmPjPt7y6KbfW/LVM5X8=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="/">
      Techiedeepdive
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/reading-list/">Reading list</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/tags/">Tags</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="/posts/2025/06/hft-itch-protocol-primer/">
              HFT - ITCH protocol primer
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2025-06-12T00:00:00Z">
                June 12, 2025
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/hft/">Hft</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>I have been dabbling with HFT for few weeks now. So, I thought to go through of the protocols such ITCH and OUCH. This post is about <a href="https://www.nasdaqtrader.com/content/technicalsupport/specifications/dataproducts/NQTVITCHSpecification.pdf"  class="external-link" target="_blank" rel="noopener">ITCH</a></p>
<blockquote>
<p>Nasdaq TotalView ITCH is a direct data feed product offered by The Nasdaq Stock Market, LLC. This specification covers
both the software and hardware (FPGA) versions of the feed.</p></blockquote>
<blockquote>
<p>Nasdaq will broadcast the TotalView ITCH FPGA feed from the U.S. primary data center facility in Carteret,
New Jersey in the MoldUDP64 protocol option only. Given the unshaped network traffic, Nasdaq is requiring firms to
have 10 Gb or 40 Gb network connection into the Carteret, NJ data center to obtain the TotalView ITCH FPGA feed.
As with the software version of the feed, the TotalView ITCH FPGA feed will be comprised of a series of sequenced
order messages. Outside of the fact that the FPGA data delivery is unthrottled or unshaped at the network level, the
TotalView-•-ITCH payload will be the same for both versions of the TotalView-•-ITCH 5.0 data formats. TotalView ITCH
FPGA product is guaranteed to disseminate payload messages in the same exact order as the software-•-based version
of the TotalView ITCH feed.</p></blockquote>
<h1 id="messages">
  Messages
  <a class="heading-link" href="#messages">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>This is quick summary of messages. The fields are detailed in the document.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>1. System Control Messages
</span></span><span style="display:flex;"><span>System Event (S) – Signals system status changes like market open/close (O, S, Q, M, E, C).
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2. Reference Data / Stock-Related Messages
</span></span><span style="display:flex;"><span>Stock Directory (R) – Security metadata: symbol, market category, financial status.
</span></span><span style="display:flex;"><span>Stock Trading Action (H) – Trading status: halted, paused, quoting, trading.
</span></span><span style="display:flex;"><span>Reg SHO Indicator (Y) – Short sale restriction status (Rule 201).
</span></span><span style="display:flex;"><span>Market Participant Position (L) – Status of market makers for each security.
</span></span><span style="display:flex;"><span>Market-Wide Circuit Breaker (V, W) – Decline levels and status.
</span></span><span style="display:flex;"><span>IPO Quoting Period Update (K) – IPO quoting schedule and pricing.
</span></span><span style="display:flex;"><span>LULD Auction Collar (J) – Auction thresholds for reopening paused securities.
</span></span><span style="display:flex;"><span>Operational Halt (h) – Exchange-specific trading interruptions.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>3. Order Book Activity
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Add Orders
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Add Order – No MPID (A) – Adds order without participant ID.
</span></span><span style="display:flex;"><span>Add Order with MPID (F) – Adds order with participant attribution.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Modify Orders
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Order Executed (E) – Indicates execution against a posted order.
</span></span><span style="display:flex;"><span>Order Executed With Price (C) – Execution at a different price than posted.
</span></span><span style="display:flex;"><span>Order Cancel (X) – Partial cancellation of an order.
</span></span><span style="display:flex;"><span>Order Delete (D) – Full removal of an order.
</span></span><span style="display:flex;"><span>Order Replace (U) – Cancels and replaces an existing order.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>4. Trade Messages
</span></span><span style="display:flex;"><span>Trade (Non-Cross) (P) – Matches involving hidden orders.
</span></span><span style="display:flex;"><span>Cross Trade (Q) – Bulk executions from open/close/IPO crosses.
</span></span><span style="display:flex;"><span>Broken Trade (B) – Execution canceled due to error.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>5. Auction/Cross Support
</span></span><span style="display:flex;"><span>Net Order Imbalance Indicator (NOII) (I) – Pre-cross imbalance and indicative prices.
</span></span><span style="display:flex;"><span>Retail Price Improvement Indicator (RPII) (N) – Retail interest indication for buy/sell side.
</span></span><span style="display:flex;"><span>Direct Listing Capital Raise (O) – Price discovery info for direct listing with capital raise.
</span></span></code></pre></div><h2 id="order-messages">
  Order messages
  <a class="heading-link" href="#order-messages">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The order book keeps track of buy and sell order coming in ( A and F), when order executed comes in, the order book is updated to reflect the incoming execution. Same for other order modification messages such as cancel/delete/replace.</p>
<h2 id="trade-messages">
  Trade messages
  <a class="heading-link" href="#trade-messages">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The trade messages (P) is interesting one as it seems indicate trade happening for hidden orders (orders are not in order book). So, It&rsquo;s important to keep track of those as well.</p>
<h1 id="implementation">
  Implementation
  <a class="heading-link" href="#implementation">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h1>
<p>I asked cline to generate message packer and unpacker using ITCH format in ITCH documentation. The generated code is pretty good as it generated <code>ItchMessage</code> and several classes for different message types.</p>
<div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff7b72">import</span> <span style="color:#ff7b72">struct</span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">from</span> <span style="color:#ff7b72">typing</span> <span style="color:#ff7b72">import</span> Iterator, BinaryIO
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">ItchMessage</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">__init__</span>(self, message_type: str, payload: bytes):
</span></span><span style="display:flex;"><span>        self<span style="color:#ff7b72;font-weight:bold">.</span>message_type <span style="color:#ff7b72;font-weight:bold">=</span> message_type  <span style="color:#8b949e;font-style:italic"># 1 char</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#ff7b72;font-weight:bold">.</span>payload <span style="color:#ff7b72;font-weight:bold">=</span> payload            <span style="color:#8b949e;font-style:italic"># variable length</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">pack</span>(self) <span style="color:#ff7b72;font-weight:bold">-&gt;</span> bytes:
</span></span><span style="display:flex;"><span>        <span style="color:#a5d6ff">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">        Packs the message into bytes.
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">        Format: 1 byte message_type + payload
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">return</span> self<span style="color:#ff7b72;font-weight:bold">.</span>message_type<span style="color:#ff7b72;font-weight:bold">.</span>encode(<span style="color:#a5d6ff">&#39;ascii&#39;</span>) <span style="color:#ff7b72;font-weight:bold">+</span> self<span style="color:#ff7b72;font-weight:bold">.</span>payload
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#d2a8ff;font-weight:bold">@classmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">unpack</span>(cls, data: bytes):
</span></span><span style="display:flex;"><span>        <span style="color:#a5d6ff">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">        Unpacks bytes into an ItchMessage.
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">        Assumes first byte is message_type, rest is payload.
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">if</span> len(data) <span style="color:#ff7b72;font-weight:bold">&lt;</span> <span style="color:#a5d6ff">1</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">raise</span> <span style="color:#f0883e;font-weight:bold">ValueError</span>(<span style="color:#a5d6ff">&#34;Data too short to unpack&#34;</span>)
</span></span><span style="display:flex;"><span>        message_type <span style="color:#ff7b72;font-weight:bold">=</span> data[<span style="color:#a5d6ff">0</span>:<span style="color:#a5d6ff">1</span>]<span style="color:#ff7b72;font-weight:bold">.</span>decode(<span style="color:#a5d6ff">&#39;ascii&#39;</span>)
</span></span><span style="display:flex;"><span>        payload <span style="color:#ff7b72;font-weight:bold">=</span> data[<span style="color:#a5d6ff">1</span>:]
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">return</span> cls(message_type, payload)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff7b72">class</span> <span style="color:#f0883e;font-weight:bold">SystemEventMessage</span>(ItchMessage):
</span></span><span style="display:flex;"><span>    <span style="color:#a5d6ff">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    System Event Message Type
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    Format:
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    Name            Offset  Length  Value   Notes
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    Message Type    0       1       &#34;S&#34;     System Event Message
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    Stock Locate    1       2       Integer Always 0
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    Tracking Number 3       2       Integer Nasdaq internal tracking number
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    Timestamp       5       6       Integer Nanoseconds since midnight
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    Event Code      11      1       Alpha   System Event Code
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    Event Codes:
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    Code    Explanation
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    &#34;O&#34;     Start of Messages. First message sent in any trading day (after time stamp messages)
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    &#34;S&#34;     Start of System hours. NASDAQ is open and ready to start accepting orders
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    &#34;Q&#34;     Start of Market hours. Market Hours orders are available for execution
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    &#34;M&#34;     End of Market hours. Market Hours orders are no longer available for execution
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    &#34;E&#34;     End of System hours. NASDAQ is closed and will not accept new orders
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    &#34;C&#34;     End of Messages. Last message sent in any trading day
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">    &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8b949e;font-style:italic"># Valid event codes and their descriptions</span>
</span></span><span style="display:flex;"><span>    EVENT_CODES <span style="color:#ff7b72;font-weight:bold">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a5d6ff">&#39;O&#39;</span>: <span style="color:#a5d6ff">&#39;Start of Messages&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a5d6ff">&#39;S&#39;</span>: <span style="color:#a5d6ff">&#39;Start of System hours&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a5d6ff">&#39;Q&#39;</span>: <span style="color:#a5d6ff">&#39;Start of Market hours&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a5d6ff">&#39;M&#39;</span>: <span style="color:#a5d6ff">&#39;End of Market hours&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a5d6ff">&#39;E&#39;</span>: <span style="color:#a5d6ff">&#39;End of System hours&#39;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a5d6ff">&#39;C&#39;</span>: <span style="color:#a5d6ff">&#39;End of Messages&#39;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">__init__</span>(self, stock_locate: int, tracking_number: int, timestamp: int, event_code: str):
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">if</span> event_code <span style="color:#ff7b72;font-weight:bold">not</span> <span style="color:#ff7b72;font-weight:bold">in</span> self<span style="color:#ff7b72;font-weight:bold">.</span>EVENT_CODES:
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">raise</span> <span style="color:#f0883e;font-weight:bold">ValueError</span>(<span style="color:#79c0ff">f</span><span style="color:#a5d6ff">&#34;Invalid event code &#39;</span><span style="color:#a5d6ff">{</span>event_code<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">&#39;. Must be one of: </span><span style="color:#a5d6ff">{</span><span style="color:#a5d6ff">&#39;, &#39;</span><span style="color:#ff7b72;font-weight:bold">.</span>join(self<span style="color:#ff7b72;font-weight:bold">.</span>EVENT_CODES<span style="color:#ff7b72;font-weight:bold">.</span>keys())<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff">&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        super()<span style="color:#ff7b72;font-weight:bold">.</span><span style="color:#d2a8ff;font-weight:bold">__init__</span>(<span style="color:#a5d6ff">&#34;S&#34;</span>, <span style="color:#79c0ff">b</span><span style="color:#a5d6ff">&#39;&#39;</span>)  <span style="color:#8b949e;font-style:italic"># Initialize parent with type &#34;S&#34;</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#ff7b72;font-weight:bold">.</span>stock_locate <span style="color:#ff7b72;font-weight:bold">=</span> stock_locate
</span></span><span style="display:flex;"><span>        self<span style="color:#ff7b72;font-weight:bold">.</span>tracking_number <span style="color:#ff7b72;font-weight:bold">=</span> tracking_number
</span></span><span style="display:flex;"><span>        self<span style="color:#ff7b72;font-weight:bold">.</span>timestamp <span style="color:#ff7b72;font-weight:bold">=</span> timestamp
</span></span><span style="display:flex;"><span>        self<span style="color:#ff7b72;font-weight:bold">.</span>event_code <span style="color:#ff7b72;font-weight:bold">=</span> event_code
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic"># Override payload with packed binary data</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic"># Pack 6-byte timestamp as two parts: 4-byte prefix and 2-byte suffix</span>
</span></span><span style="display:flex;"><span>        timestamp_hi <span style="color:#ff7b72;font-weight:bold">=</span> timestamp <span style="color:#ff7b72;font-weight:bold">&gt;&gt;</span> <span style="color:#a5d6ff">16</span>
</span></span><span style="display:flex;"><span>        timestamp_lo <span style="color:#ff7b72;font-weight:bold">=</span> timestamp <span style="color:#ff7b72;font-weight:bold">&amp;</span> <span style="color:#a5d6ff">0xFFFF</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#ff7b72;font-weight:bold">.</span>payload <span style="color:#ff7b72;font-weight:bold">=</span> struct<span style="color:#ff7b72;font-weight:bold">.</span>pack(<span style="color:#a5d6ff">&#34;!HHIHc&#34;</span>, 
</span></span><span style="display:flex;"><span>            stock_locate,           <span style="color:#8b949e;font-style:italic"># H = 2 byte unsigned short</span>
</span></span><span style="display:flex;"><span>            tracking_number,        <span style="color:#8b949e;font-style:italic"># H = 2 byte unsigned short</span>
</span></span><span style="display:flex;"><span>            timestamp_hi,           <span style="color:#8b949e;font-style:italic"># I = 4 byte timestamp prefix</span>
</span></span><span style="display:flex;"><span>            timestamp_lo,           <span style="color:#8b949e;font-style:italic"># H = 2 byte timestamp suffix</span>
</span></span><span style="display:flex;"><span>            event_code<span style="color:#ff7b72;font-weight:bold">.</span>encode(<span style="color:#a5d6ff">&#39;ascii&#39;</span>)  <span style="color:#8b949e;font-style:italic"># c = char</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#d2a8ff;font-weight:bold">@classmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff7b72">def</span> <span style="color:#d2a8ff;font-weight:bold">unpack</span>(cls, data: bytes):
</span></span><span style="display:flex;"><span>        <span style="color:#a5d6ff">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">        Unpacks bytes into a SystemEventMessage.
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">        Expects 12 bytes total (1 type + 11 payload)
</span></span></span><span style="display:flex;"><span><span style="color:#a5d6ff">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">if</span> len(data) <span style="color:#ff7b72;font-weight:bold">&lt;</span> <span style="color:#a5d6ff">12</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">raise</span> <span style="color:#f0883e;font-weight:bold">ValueError</span>(<span style="color:#a5d6ff">&#34;Data too short to unpack SystemEventMessage&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        message_type <span style="color:#ff7b72;font-weight:bold">=</span> data[<span style="color:#a5d6ff">0</span>:<span style="color:#a5d6ff">1</span>]<span style="color:#ff7b72;font-weight:bold">.</span>decode(<span style="color:#a5d6ff">&#39;ascii&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">if</span> message_type <span style="color:#ff7b72;font-weight:bold">!=</span> <span style="color:#a5d6ff">&#34;S&#34;</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#ff7b72">raise</span> <span style="color:#f0883e;font-weight:bold">ValueError</span>(<span style="color:#79c0ff">f</span><span style="color:#a5d6ff">&#34;Invalid message type </span><span style="color:#a5d6ff">{</span>message_type<span style="color:#a5d6ff">}</span><span style="color:#a5d6ff"> for SystemEventMessage&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#8b949e;font-style:italic"># Unpack the 6-byte timestamp as two parts and combine them</span>
</span></span><span style="display:flex;"><span>        stock_locate, tracking_number, timestamp_hi, timestamp_lo, event_code <span style="color:#ff7b72;font-weight:bold">=</span> struct<span style="color:#ff7b72;font-weight:bold">.</span>unpack(<span style="color:#a5d6ff">&#34;!HHIHc&#34;</span>, data[<span style="color:#a5d6ff">1</span>:])
</span></span><span style="display:flex;"><span>        timestamp <span style="color:#ff7b72;font-weight:bold">=</span> (timestamp_hi <span style="color:#ff7b72;font-weight:bold">&lt;&lt;</span> <span style="color:#a5d6ff">16</span>) <span style="color:#ff7b72;font-weight:bold">|</span> timestamp_lo
</span></span><span style="display:flex;"><span>        <span style="color:#ff7b72">return</span> cls(
</span></span><span style="display:flex;"><span>            stock_locate,
</span></span><span style="display:flex;"><span>            tracking_number,
</span></span><span style="display:flex;"><span>            timestamp,
</span></span><span style="display:flex;"><span>            event_code<span style="color:#ff7b72;font-weight:bold">.</span>decode(<span style="color:#a5d6ff">&#39;ascii&#39;</span>)
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div>
      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ©
    
    2025
    
    ·
    
      Licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA-4.0</a>
    ·
    
    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/" target="_blank" rel="noopener">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.6ae284be93d2d19dad1f02b0039508d9aab3180a12a06dcc71b0b0ef7825a317.js" integrity="sha256-auKEvpPS0Z2tHwKwA5UI2aqzGAoSoG3McbCw73gloxc="></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>

</html>
