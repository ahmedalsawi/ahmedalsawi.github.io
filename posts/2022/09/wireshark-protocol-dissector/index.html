<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Wireshark is popular protocol analyzer used for network or other packet based protocols. It uses dissectors for each protocol. The protocols are builtin but wireshark provides lua interface to define and register new dissectors.
Generating pcap with scapy I am using scapy to generate pcap for made-up protocol with two fields name and len. In this example, I am generating 2 packets in pcap.
from scapy.all import * class Disney(Packet): name = &amp;#34;DisneyPacket &amp;#34; fields_desc=[ ShortField(&amp;#34;len&amp;#34;,0), StrLenField(&amp;#39;name&amp;#39;,&amp;#34;&amp;#34;) ] pkt=[ Disney(len=6, name=&amp;#34;foobar&amp;#34;), Disney(len=7, name=&amp;#34;hhhfffk&amp;#34;)] wrpcap(&amp;#39;disney." />
<meta name="keywords" content=", network" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/2022/09/wireshark-protocol-dissector/" />


    <title>
        
            Wireshark protocol dissector :: Techiedeepdive 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css">






<meta itemprop="name" content="Wireshark protocol dissector">
<meta itemprop="description" content="Wireshark is popular protocol analyzer used for network or other packet based protocols. It uses dissectors for each protocol. The protocols are builtin but wireshark provides lua interface to define and register new dissectors.
Generating pcap with scapy I am using scapy to generate pcap for made-up protocol with two fields name and len. In this example, I am generating 2 packets in pcap.
from scapy.all import * class Disney(Packet): name = &#34;DisneyPacket &#34; fields_desc=[ ShortField(&#34;len&#34;,0), StrLenField(&#39;name&#39;,&#34;&#34;) ] pkt=[ Disney(len=6, name=&#34;foobar&#34;), Disney(len=7, name=&#34;hhhfffk&#34;)] wrpcap(&#39;disney."><meta itemprop="datePublished" content="2022-09-03T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-09-03T00:00:00+00:00" />
<meta itemprop="wordCount" content="279"><meta itemprop="image" content=""/>
<meta itemprop="keywords" content="network," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>

<meta name="twitter:title" content="Wireshark protocol dissector"/>
<meta name="twitter:description" content="Wireshark is popular protocol analyzer used for network or other packet based protocols. It uses dissectors for each protocol. The protocols are builtin but wireshark provides lua interface to define and register new dissectors.
Generating pcap with scapy I am using scapy to generate pcap for made-up protocol with two fields name and len. In this example, I am generating 2 packets in pcap.
from scapy.all import * class Disney(Packet): name = &#34;DisneyPacket &#34; fields_desc=[ ShortField(&#34;len&#34;,0), StrLenField(&#39;name&#39;,&#34;&#34;) ] pkt=[ Disney(len=6, name=&#34;foobar&#34;), Disney(len=7, name=&#34;hhhfffk&#34;)] wrpcap(&#39;disney."/>




    <meta property="og:title" content="Wireshark protocol dissector" />
<meta property="og:description" content="Wireshark is popular protocol analyzer used for network or other packet based protocols. It uses dissectors for each protocol. The protocols are builtin but wireshark provides lua interface to define and register new dissectors.
Generating pcap with scapy I am using scapy to generate pcap for made-up protocol with two fields name and len. In this example, I am generating 2 packets in pcap.
from scapy.all import * class Disney(Packet): name = &#34;DisneyPacket &#34; fields_desc=[ ShortField(&#34;len&#34;,0), StrLenField(&#39;name&#39;,&#34;&#34;) ] pkt=[ Disney(len=6, name=&#34;foobar&#34;), Disney(len=7, name=&#34;hhhfffk&#34;)] wrpcap(&#39;disney." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2022/09/wireshark-protocol-dissector/" /><meta property="og:image" content=""/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-03T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-09-03T00:00:00+00:00" /><meta property="og:site_name" content="Techiedeepdive" />







    <meta property="article:published_time" content="2022-09-03 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts">Blog</a></li><li><a href="/reading-list/">Reading list</a></li><li><a href="/tags/">Tags</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        2 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="/posts/2022/09/wireshark-protocol-dissector/">Wireshark protocol dissector</a>
      </h1>

      

      

      <div class="post-content">
        <p>Wireshark is popular protocol analyzer used for network or other packet based protocols. It uses <code>dissectors</code> for each protocol. The protocols are builtin but wireshark provides lua interface to define and register new dissectors.</p>
<h1 id="generating-pcap-with-scapy">Generating pcap with scapy</h1>
<p>I am using scapy to generate pcap for made-up protocol with two fields <code>name</code> and <code>len</code>. In this example, I am generating 2 packets in pcap.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">from</span> scapy.all <span style="color:#fff;font-weight:bold">import</span> *

<span style="color:#fff;font-weight:bold">class</span> Disney(Packet):
    name = <span style="color:#0ff;font-weight:bold">&#34;DisneyPacket &#34;</span>
    fields_desc=[
                ShortField(<span style="color:#0ff;font-weight:bold">&#34;len&#34;</span>,<span style="color:#ff0;font-weight:bold">0</span>),
                StrLenField(<span style="color:#0ff;font-weight:bold">&#39;name&#39;</span>,<span style="color:#0ff;font-weight:bold">&#34;&#34;</span>)
                ]

pkt=[ Disney(<span style="color:#fff;font-weight:bold">len</span>=<span style="color:#ff0;font-weight:bold">6</span>, name=<span style="color:#0ff;font-weight:bold">&#34;foobar&#34;</span>),
        Disney(<span style="color:#fff;font-weight:bold">len</span>=<span style="color:#ff0;font-weight:bold">7</span>, name=<span style="color:#0ff;font-weight:bold">&#34;hhhfffk&#34;</span>)]

wrpcap(<span style="color:#0ff;font-weight:bold">&#39;disney.pcap&#39;</span>, pkt, append=<span style="color:#fff;font-weight:bold">True</span>, linktype=DLT_NULL)
</code></pre></div><h1 id="dissector">Dissector</h1>
<p>To install the dissector, it is copied to <code>~/.local/lib/wireshark/plugins/</code>. wireshark (and tshark) load the lua scripts on start up.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp t.lua ~/.local/lib/wireshark/plugins/t.lua
</code></pre></div><p>The dissector defines 2 fields <code>len</code> and <code>name</code>. and eventually registers the proto with <code>register_postdissector</code>. The dissector adds the two fields to wireshark tree with <code>subtree:add_le</code></p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua">print(<span style="color:#0ff;font-weight:bold">&#34;loaded&#34;</span>)

<span style="color:#fff;font-weight:bold">local</span> myproto = Proto(<span style="color:#0ff;font-weight:bold">&#34;swapper&#34;</span>,<span style="color:#0ff;font-weight:bold">&#34;Dummy proto to edit info column&#34;</span>)
<span style="color:#007f7f">-- the dissector function callback</span>

len      = ProtoField.int32(<span style="color:#0ff;font-weight:bold">&#34;swapper.len&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;len&#34;</span>, base.DEC)
name     = ProtoField.string(<span style="color:#0ff;font-weight:bold">&#34;swapper.name&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;name&#34;</span>)

myproto.fields = { len, name }

 <span style="color:#fff;font-weight:bold">function</span> myproto.dissector(buffer,pinfo,tree)

  length = buffer:len()
  <span style="color:#fff;font-weight:bold">if</span> length == <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#fff;font-weight:bold">then</span> <span style="color:#fff;font-weight:bold">return</span> <span style="color:#fff;font-weight:bold">end</span>

  pinfo.cols.protocol = myproto.name

  <span style="color:#fff;font-weight:bold">local</span> subtree = tree:add(myproto, buffer(), <span style="color:#0ff;font-weight:bold">&#34;swapper Protocol&#34;</span>)

  subtree:add(len, buffer(<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#ff0;font-weight:bold">2</span>))
  s = tonumber(buffer(<span style="color:#ff0;font-weight:bold">0</span>,<span style="color:#ff0;font-weight:bold">2</span>))
  print(s)
  subtree:add_le(name, buffer(<span style="color:#ff0;font-weight:bold">2</span>,s))
<span style="color:#fff;font-weight:bold">end</span>

register_postdissector(myproto)

</code></pre></div><p>Running tshark</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tshark -V -r disney.pcap
</code></pre></div><p>and voila!</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Frame 1: <span style="color:#ff0;font-weight:bold">8</span> bytes on wire (<span style="color:#ff0;font-weight:bold">64</span> bits), <span style="color:#ff0;font-weight:bold">8</span> bytes captured (<span style="color:#ff0;font-weight:bold">64</span> bits)
Null/Loopback
    Type: Unknown (0x666f)
Data (<span style="color:#ff0;font-weight:bold">4</span> bytes)

<span style="color:#ff0;font-weight:bold">0000</span>  6f <span style="color:#ff0;font-weight:bold">62</span> <span style="color:#ff0;font-weight:bold">61</span> <span style="color:#ff0;font-weight:bold">72</span>                                       obar
    Data: 6f626172
    [Length: 4]
swapper Protocol
    len: <span style="color:#ff0;font-weight:bold">6</span>
    name: foobar

Frame 2: <span style="color:#ff0;font-weight:bold">9</span> bytes on wire (<span style="color:#ff0;font-weight:bold">72</span> bits), <span style="color:#ff0;font-weight:bold">9</span> bytes captured (<span style="color:#ff0;font-weight:bold">72</span> bits)
Null/Loopback
    Type: Unknown (0x6868)
Data (<span style="color:#ff0;font-weight:bold">5</span> bytes)

<span style="color:#ff0;font-weight:bold">0000</span>  <span style="color:#ff0;font-weight:bold">68</span> <span style="color:#ff0;font-weight:bold">66</span> <span style="color:#ff0;font-weight:bold">66</span> <span style="color:#ff0;font-weight:bold">66</span> 6b                                    hfffk
    Data: 686666666b
    [Length: 5]
swapper Protocol
    len: <span style="color:#ff0;font-weight:bold">7</span>
    name: hhhfffk
</code></pre></div>
      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="tags/network/">network</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        279 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2022-09-03 01:00 &#43;0100
        

         
          
        
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2022/09/systemd-service-hello-world/">
                <span class="button__icon">←</span>
                <span class="button__text">systemd service - hello world</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="/posts/2022/08/iwlwifi-driver-crash-the-problem-and-workaround/">
                <span class="button__text">iwlwifi driver crash - The problem and workaround</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span><span><a href="posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2ce64ea6ea44a72b13dd812fc2eb5cca3efe878cce258a47c137c17edf46e0602a05e422b618a5b80b5939c731b7a293351c2f2222a21f6ee27e54a8448dd20e.js" integrity="sha512-LOZOpupEpysT3YEvwutcyj7&#43;h4zOJYpHwTfBft9G4GAqBeQithiluAtZOccxt6KTNRwvIiKiH27iflSoRI3SDg=="></script>



    </body>
</html>
