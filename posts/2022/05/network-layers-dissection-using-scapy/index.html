<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="This post goes through network layers(ethernet, IP, TCP) of a packet using scapy. scapy is a package to create, send and sniff packets. Well, scapy docs say it all:
 Scapy is a Python program that enables the user to send, sniff and dissect and forge network packets. This capability allows construction of tools that can probe, scan or attack networks.
 Packet fields Starting with IP, RFC describes packets fields as follows" />
<meta name="keywords" content=", Networking" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/2022/05/network-layers-dissection-using-scapy/" />


    <title>
        
            Network layers dissection using scapy :: Techiedeepdive 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.de188b3201233c251f4fd6306dbd2cb41e408fb8846c09781b2925de7df5025c.css">






<meta itemprop="name" content="Network layers dissection using scapy">
<meta itemprop="description" content="This post goes through network layers(ethernet, IP, TCP) of a packet using scapy. scapy is a package to create, send and sniff packets. Well, scapy docs say it all:
 Scapy is a Python program that enables the user to send, sniff and dissect and forge network packets. This capability allows construction of tools that can probe, scan or attack networks.
 Packet fields Starting with IP, RFC describes packets fields as follows"><meta itemprop="datePublished" content="2022-05-29T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-05-29T00:00:00+00:00" />
<meta itemprop="wordCount" content="400"><meta itemprop="image" content=""/>
<meta itemprop="keywords" content="Networking," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content=""/>

<meta name="twitter:title" content="Network layers dissection using scapy"/>
<meta name="twitter:description" content="This post goes through network layers(ethernet, IP, TCP) of a packet using scapy. scapy is a package to create, send and sniff packets. Well, scapy docs say it all:
 Scapy is a Python program that enables the user to send, sniff and dissect and forge network packets. This capability allows construction of tools that can probe, scan or attack networks.
 Packet fields Starting with IP, RFC describes packets fields as follows"/>




    <meta property="og:title" content="Network layers dissection using scapy" />
<meta property="og:description" content="This post goes through network layers(ethernet, IP, TCP) of a packet using scapy. scapy is a package to create, send and sniff packets. Well, scapy docs say it all:
 Scapy is a Python program that enables the user to send, sniff and dissect and forge network packets. This capability allows construction of tools that can probe, scan or attack networks.
 Packet fields Starting with IP, RFC describes packets fields as follows" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/2022/05/network-layers-dissection-using-scapy/" /><meta property="og:image" content=""/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-29T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-05-29T00:00:00+00:00" /><meta property="og:site_name" content="Techiedeepdive" />







    <meta property="article:published_time" content="2022-05-29 00:00:00 &#43;0000 UTC" />








    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts">Blog</a></li><li><a href="/reading-list/">Reading list</a></li><li><a href="/tags/">Tags</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
  <main class="post">

    <div class="post-info">
      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        2 minutes

        
      </p>
    </div>

    <article>
      <h1 class="post-title">
        <a href="/posts/2022/05/network-layers-dissection-using-scapy/">Network layers dissection using scapy</a>
      </h1>

      

      

      <div class="post-content">
        <p>This post goes through network layers(ethernet, IP, TCP) of a packet using scapy. <code>scapy</code> is a package to create, send and sniff packets. Well, scapy docs say it all:</p>
<blockquote>
<p>Scapy is a Python program that enables the user to send, sniff and dissect and forge network packets. This capability allows construction of tools that can probe, scan or attack networks.</p>
</blockquote>
<h1 id="packet-fields">Packet fields</h1>
<p>Starting with IP, <a href="https://datatracker.ietf.org/doc/html/rfc791">RFC</a> describes packets fields  as follows</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#ff0;font-weight:bold">0</span>                   <span style="color:#ff0;font-weight:bold">1</span>                   <span style="color:#ff0;font-weight:bold">2</span>                   <span style="color:#ff0;font-weight:bold">3</span>
    <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#ff0;font-weight:bold">2</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#ff0;font-weight:bold">4</span> <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#ff0;font-weight:bold">6</span> <span style="color:#ff0;font-weight:bold">7</span> <span style="color:#ff0;font-weight:bold">8</span> <span style="color:#ff0;font-weight:bold">9</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#ff0;font-weight:bold">2</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#ff0;font-weight:bold">4</span> <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#ff0;font-weight:bold">6</span> <span style="color:#ff0;font-weight:bold">7</span> <span style="color:#ff0;font-weight:bold">8</span> <span style="color:#ff0;font-weight:bold">9</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#ff0;font-weight:bold">2</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#ff0;font-weight:bold">4</span> <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#ff0;font-weight:bold">6</span> <span style="color:#ff0;font-weight:bold">7</span> <span style="color:#ff0;font-weight:bold">8</span> <span style="color:#ff0;font-weight:bold">9</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#ff0;font-weight:bold">1</span>
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |Version|  IHL  |Type of Service|          Total Length         |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |         Identification        |Flags|      Fragment Offset    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Time to Live |    Protocol   |         Header Checksum       |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                       Source Address                          |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Destination Address                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Options                    |    Padding    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                    Example Internet Datagram Header
</code></pre></div><p><a href="https://datatracker.ietf.org/doc/html/rfc793">TCP RFC</a> describes the  TCP fields including dest and source ports.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">    <span style="color:#ff0;font-weight:bold">0</span>                   <span style="color:#ff0;font-weight:bold">1</span>                   <span style="color:#ff0;font-weight:bold">2</span>                   <span style="color:#ff0;font-weight:bold">3</span>
    <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#ff0;font-weight:bold">2</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#ff0;font-weight:bold">4</span> <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#ff0;font-weight:bold">6</span> <span style="color:#ff0;font-weight:bold">7</span> <span style="color:#ff0;font-weight:bold">8</span> <span style="color:#ff0;font-weight:bold">9</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#ff0;font-weight:bold">2</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#ff0;font-weight:bold">4</span> <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#ff0;font-weight:bold">6</span> <span style="color:#ff0;font-weight:bold">7</span> <span style="color:#ff0;font-weight:bold">8</span> <span style="color:#ff0;font-weight:bold">9</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#ff0;font-weight:bold">1</span> <span style="color:#ff0;font-weight:bold">2</span> <span style="color:#ff0;font-weight:bold">3</span> <span style="color:#ff0;font-weight:bold">4</span> <span style="color:#ff0;font-weight:bold">5</span> <span style="color:#ff0;font-weight:bold">6</span> <span style="color:#ff0;font-weight:bold">7</span> <span style="color:#ff0;font-weight:bold">8</span> <span style="color:#ff0;font-weight:bold">9</span> <span style="color:#ff0;font-weight:bold">0</span> <span style="color:#ff0;font-weight:bold">1</span>
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |          Source Port          |       Destination Port        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                        Sequence Number                        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Acknowledgment Number                      |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |  Data |           |U|A|P|R|S|F|                               |
   | Offset| Reserved  |R|C|S|S|Y|I|            Window             |
   |       |           |G|K|H|T|N|N|                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |           Checksum            |         Urgent Pointer        |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                    Options                    |    Padding    |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                             data                              |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                            TCP Header Format
</code></pre></div><h1 id="scapy-dissection">Scapy dissection</h1>
<p>This is an example of scapy docs where packet ETHER/IP/TCP and eventually HTTP GET request.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#fff;font-weight:bold">from</span>  scapy.all  <span style="color:#fff;font-weight:bold">import</span> *

a=Ether(src=<span style="color:#0ff;font-weight:bold">&#34;ff:ff:ff:ff:ff:ff&#34;</span>)/IP(dst=<span style="color:#0ff;font-weight:bold">&#34;www.slashdot.org&#34;</span>)/TCP()/<span style="color:#0ff;font-weight:bold">&#34;GET /index.html HTTP/1.0 </span><span style="color:#0ff;font-weight:bold">\n\n</span><span style="color:#0ff;font-weight:bold">&#34;</span>
a.pdfdump(layer_shift=<span style="color:#ff0;font-weight:bold">1</span>)
a.psdump(<span style="color:#0ff;font-weight:bold">&#34;/tmp/isakmp_pkt.eps&#34;</span>,layer_shift=<span style="color:#ff0;font-weight:bold">1</span>)
</code></pre></div><p><code>a.show()</code> will print the fields of the packets.</p>
<div class="highlight"><pre tabindex="0" style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">In [5]: a.show()
<span style="color:#007f7f">###[ Ethernet ]###</span>
  dst       = ff:ff:ff:ff:ff:ff
  src       = ff:ff:ff:ff:ff:ff
  <span style="color:#fff;font-weight:bold">type</span>      = IPv4
<span style="color:#007f7f">###[ IP ]###</span>
     version   = <span style="color:#ff0;font-weight:bold">4</span>
     ihl       = None
     tos       = 0x0
     len       = None
     id        = <span style="color:#ff0;font-weight:bold">1</span>
     flags     =
     frag      = <span style="color:#ff0;font-weight:bold">0</span>
     ttl       = <span style="color:#ff0;font-weight:bold">64</span>
     proto     = tcp
     chksum    = None
     src       = 192.168.1.23
     dst       = Net(<span style="color:#0ff;font-weight:bold">&#34;www.slashdot.org/32&#34;</span>)
     <span style="color:#0ff;font-weight:bold">\o</span>ptions   <span style="color:#0ff;font-weight:bold">\
</span><span style="color:#0ff;font-weight:bold"></span><span style="color:#007f7f">###[ TCP ]###</span>
        sport     = ftp_data
        dport     = http
        seq       = <span style="color:#ff0;font-weight:bold">0</span>
        ack       = <span style="color:#ff0;font-weight:bold">0</span>
        dataofs   = None
        reserved  = <span style="color:#ff0;font-weight:bold">0</span>
        flags     = S
        window    = <span style="color:#ff0;font-weight:bold">8192</span>
        chksum    = None
        urgptr    = <span style="color:#ff0;font-weight:bold">0</span>
        options   = <span style="color:#0ff;font-weight:bold">&#39;&#39;</span>
<span style="color:#007f7f">###[ Raw ]###</span>
           load      = <span style="color:#0ff;font-weight:bold">&#39;GET /index.html HTTP/1.0 \n\n&#39;</span>
</code></pre></div><p>and scapy even generate nice diagram for headers
<img src="/scapy.png" alt="Example image"></p>

      </div>
    </article>

    <hr />

    <div class="post-info">
      
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="tags/networking/">Networking</a></span>
        
    </p>

      

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
        400 Words
      </p>

      <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        
          2022-05-29 01:00 &#43;0100
        

         
          
        
      </p>
    </div>

    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>

        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="/posts/2022/05/riscv-riscv-python-model-deepdive/">
                <span class="button__icon">←</span>
                <span class="button__text">RISCV riscv python model deepdive</span>
              </a>
            </span>
          

          
            <span class="button next">
              <a href="/posts/2022/05/levenshtein-distance/">
                <span class="button__text">Levenshtein Distance</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    


    

    

  </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2023</span>
            
            <span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></span><span><a href="posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
          </div>
    </div>
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.2ce64ea6ea44a72b13dd812fc2eb5cca3efe878cce258a47c137c17edf46e0602a05e422b618a5b80b5939c731b7a293351c2f2222a21f6ee27e54a8448dd20e.js" integrity="sha512-LOZOpupEpysT3YEvwutcyj7&#43;h4zOJYpHwTfBft9G4GAqBeQithiluAtZOccxt6KTNRwvIiKiH27iflSoRI3SDg=="></script>



    </body>
</html>
